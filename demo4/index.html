<html>
<head>
	<title>评论组件</title>
	<meta chartset="utf-8">
</head>
<body>
	<div id="app"></div>
	<script type="text/jsx">
		var CommentBox = React.createClass({
			getInitialState: function() {
				return {data: []};
			},
			componentDidMount: function() {
				$.ajax({
					url: this.props.url,
					dataType: 'json',
					success: function(data) {
						this.setState({data: data});
					}.bind(this),
					error: function(xhr, status, err) {
						console.error(this.props.url, status, err.toString());
					}.bind(this)
				});
			},
			render: function() {
				return (
					<div className="commentBox">
						<h1>Comments</h1>
						<CommentList data={this.state.data} />
						<CommentForm />
					</div>
				);
			}
		});

		var CommentList = React.createClass({
			render: function() {
				var commentNodes = this.props.data.map(function (comment) {
					return (
						<Comment author={comment.author}>
							{comment.text}
						</Comment>
					)
				});
				return (
					<div className="commentList">
						{commentNodes}
					</div>
				);
			}
		});

		var converter = new showdown.Converter();

		var Comment = React.createClass({
			render: function() {
				var rawMarkup = converter.makeHtml(this.props.children.toString());
				return (
					<div className="comment">
						<h2 className="commentAuthor">{this.props.author}</h2>
						<span dangerouslySetInnerHTML={{__html: rawMarkup}} />
					</div>
				);
			}
		});

		var CommentForm = React.createClass({
			render: function() {
				return (
					<div className="commentForm">
						Hello, World, I am a commentForm.
					</div>
				);
			}
		});

		React.render(
			<CommentBox url="comments.json" />,
			document.getElementById('app')
		);
	</script>

	<script src="../bower_components/react/react.min.js"></script>
	<script src="../bower_components/react/JSXTransformer.js"></script>
	<script src="../bower_components/showdown/dist/showdown.min.js"></script>
	<script src="../bower_components/jquery/dist/jquery.min.js"></script>
</body>
</html>
